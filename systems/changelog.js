const changeloglist = [
//             {text:`- Added the In-Betweens (3 new biomes only accessable via divergence)
//     - These biomes are: Swamp, Beach, and Savanna
// - Added 21 new mobs
//     - Lilypad, Flowing Lilypad, Shiny Lilypad, Poison Dart Frog, Dragonfly, Water Strider, Swampy Moth, Moss, Water Mocassin, Mocassin Burrow, Whirlpool, Coconut, Hermit Crab, Sea Turtle, Sand Dollar, Tick, Termite Soldier, Termite Worker, Termite Baby, Termite Queen, and Termite Mound
// - Added 19 new petals
//     - Blossom, Shiny Leaf, Carapace, Lilypad, Trinket of the Hivemind, Trinket of the Sea, Trinket of the Wild, Ant Eggs, Moss, Waterlogged Dark Compass, Coconut, Hermit Shell, Turtle Shell, Plank, Blueberries, Pomegranate, Carrot, and Water
// - Sticks can now spawn Whirlpools if Trinket of the Sea is equipped
// - Coral now works properly in PvP
// - Nerfed Blood Stinger Damage
// - Sandstorm summons are not compatible with Whirlpool summons`, date: `July , 2025`},

{text:`- Added 2 new mobs to Garden
- Added 3 new petals to Garden
- Missiles shot by enemies no longer slow down per rarity after Omnipotent
- Nerfed termite bosses in Savanna`, date: `August 6, 2025`},
{text:`- Nerfed Fangs droprate from Tick
- Adjusted wave power in Savanna
- Lightning no longer chains onto Termite Mounds`, date: `August 4, 2025`},
    {text:`- Amulets stack with 75% reduction now, up from 50%
- Added a few more special waves to Savanna and rebalanced existing ones`, date: `August 3, 2025`},

    {text:`- Divergence Amulet re-enabled
- Astral+ Divergence Amulet can now access a new biome: Savanna
- Added an easter egg to sapphired plastics
- Previous filter changes now apply to usernames
- Buffed Pomegranate
- Nerfed Termites significantly
- Buffed Soldier Termite summon
- Fixed a bug with damage spread where petal effects would also spread
- You are now notified about what message has muted you
- High-rarity dailies now announce in our discord server`, date: `August 2, 2025`},
    {text:`- Buffed Astral+ Ruby pet lifespan
- Buffed Neutron Star
- Blood Leaf self-damage reduced
- Increased health of Honey petal
- Added two new rarities of mobs
- Fixed several bugs`, date: `July 30, 2025`},
    {text:`- Revamped Astral+ Neutron Star
- While both attacking and defending, attacking now overrides behavior for Honey and Neutron Star
- Neutron Star now aims towards your movement of direction
- Nerfed the radius of several Desert mobs`, date: `July 29, 2025`},
    {text:`- Fixed several bugs with mana system`, date: `July 28, 2025`},
    {text:`- Amulets of Grace & Time now use a new mana system
- Completely overhauled late-game progression past Astral rarity
- Lots of unnoticable back-end changes`, date: `July 27, 2025`},
    {text:`- Fixed several bugs`, date: `July 22, 2025`},
    {text:`- Added tons of new stats shown on galleries and petal stats
- Lucky waves now give more XP
- Some balancing changes`, date: `July 18, 2025`},
    {text:`- You can now gain XP while dead if the game is not over and you have just died
- Made the chat filter system more robust`, date: `July 16, 2025`},
    {text:`- Added 3 new petals
- Adjusted late-game mob rarity distribution`, date: `July 15, 2025`},
    {text:`- Fixed bugs regarding burrows spawning the wrong type of mob
- Several balancing changes
- Removed an experimental feature with Astral Amulet of Divergence; will return later-on`, date: `July 14, 2025`},
    {text:`- Several bugfixes`, date: `July 7, 2025`},
    {text:`- Nerfed self-damage of Blood Leaf
- High rarity Pentagon now have funny abilities
- You can now send /clear to clear all chat messages
- Radiance is now more consistent
- Several balancing changes`, date: `July 6, 2025`},
    {text:`- Adjusted damage stats for all Compass-type petals
- Updated statboxes for some petals
- Updated pet kill system
- Ascended players are now forced as a flower in PvP, but do not gain 10x damage nerf
- Fixed bugs regarding summons killing each other when they were not intended to
- Fixed bugs regarding summons in PvP being extremely powerful
- Other general bugfixes`, date: `July 5, 2025`},
    {text:`- Lots of backend changes
- Revamped Astral Mandible; now has higher critical chance and reduced reload
- Ascended self-damage petal rebalancing`, date: `July 3, 2025`},
    {text:`- Nerfed several petals in PVP`, date: `June 26, 2025`},
            {text:`- Overhauled PVP
    - The Main PvP room is significantly larger now
    - Many types of mobs now spawn in PvP, and drop tokens
    - Tokens drops depend on Mob Rarity, Mob Type, and Player Score
    - Added a score system for PvP, you gain score based off the type/rarity of mobs killed, or 25% of the score of a killed player
    - Mobs in PvP have a max looting cap of 4 players
    - Bosses spawn by replacing a random mob, meaning multiple bosses can spawn now
    - Segmented PvP Bosses now indicate how many segments they spawn with
    - Starfish PvP Boss has 1kx less healing
    - Dying makes you lose 75% score
    - Bosses that spawn bosses upon death no longer spawn bosses with inflated rarities
    - Mobs now properly give damage credit when they get 1-shotted LMAO
    - Various changes to make certain petals such as lightning or missile more reliable
    - Nerfed Blood Corn in PvP significantly
    - Nerfed Ruby in PvP significantly
    - Buffed Bone and Pollen armor in PvP (you need to use cutter if you don't want to get nuked)
    - Adjusted formula for pvp spawn rarities
- PVP IS SUBJECT TO CHANGES!!!

- Added 3 new petals (unobtainable atm)
- Heavy no longer sticks to mobs
- Added certain variants to Amulets to indicate that they are not useable
- Fixed a bug where Mini Flower would crash the server
- Developers now have their own death render and properly show up in squad menu
- Developer messages are now red
- Amulets no longer load whenever they cannot be used anymore
- Amulet of Time works as a temporary global web (yay webbing spiders!!!)
- Fixed sapphired Leech and Electric Eel pushing themselves
- Fixed spining Leech and Electric Eel boss segments not working properly
- Added an Exit Game button at the top left corner of the screen
- Buffed Astral Fire Missile (very much subject to change)
- Waterlogged Compass now has 20 segments
- Mandible now has 3 segments
- Ascended Heavy should now push mobs`, date: `June 25, 2025`},
           {text:`- Blood Light reworked to function like a normal Blood Stinger
- Various late-game changes`, date: `June 3, 2025`},
           {text:`- New high-quality petal rendering option
- Adjusted health reductions based on the # of flowers in squad again`, date: `May 31, 2025`},
           {text:`- Revamped Ascended Egg petals`, date: `May 29, 2025`},
           {text:`- Ascended summons now always come to the player
- Various petal balances
- Made Celestial craftrate plausible for future progression`, date: `May 28, 2025`},
           {text:`- Fixed various bugs with Enemy Boxes (below the wave-bar)
- Fixed bugs with number formatting
- Increased Max HP / Level`, date: `May 26, 2025`},
           {text:`- Various bug-fixes
- Added 7 new rarities`, date: `May 25, 2025`},
           {text:`- Added a new boss
- Added an option to disable the ascending prompt
- Jellyfish pet lightning is now based off squad size
- Adjusted Squad Mob HP values based on player count
- Certain Ascended petals have been fixed
- Various late-game petal changes`, date: `May 24, 2025`},
           {text:`- Rubied Jellyfish no longer zap enemies
- Reduced Crab & Starfish mob radius & reduced Crab detection distance
- Adjusted some late-game petal stats`, date: `May 23, 2025`},
           {text:`- Various bug fixes and petal adjustments`, date: `May 22, 2025`},
           {text:`- Updated XP rewards from mobs and reduced XP from daily at high levels
- Adjusted some mob sizes`, date: `May 21, 2025`},
           {text:`- Changed Astral Jelly to apply when defending instead of when not attacking`, date: `May 20, 2025`},
           {text:`- Adjusted size of some mobs`, date: `May 19, 2025`},
           {text:`- Made most Astral petals feel a bit more special
- Buffed all Pollen under Omnipotent`, date: `May 18, 2025`},
           {text:`- Locusts are now slightly smaller
- Reduced Blood Rose self-damage upon fail
- Greatly nerfed the droprates of Ethereal mobs
- Reduced the wave requirement for Transcendent bosses`, date: `May 17, 2025`},
           {text:`- Nerfed Ascended Stick & buffed all Ascended damage; hopefully games are less reliant on purely sticks
- Adjusted waves past 241 again
- Final push is now capped for waves past 180; the excess will be evenly distributed across the rest of the wave
- Some optimizations on the server
- Nerfed some special waves`, date: `May 16, 2025`},
           {text:`- Several large optimizations on the server
- Adjusted waves past 241`, date: `May 15, 2025`},
           {text:`- Fixed Ascended blood leaf
- Changed all stat systems to look better
- Changed some extremely high rarity names and colors`, date: `May 14, 2025`},
           {text:`- Added 2 new petals to the Desert biome
- Nerfed Transcendent+ mob health
- Buffed Astral petal damage (likely for the last time)
- Buffed Rose petal
- Fixed a bug where Blood Leaf would count missiles as kills`, date: `May 13, 2025`},
           {text:`- Added a new petal to the Desert biome
- Dandelion-inflicted healing reduction now shows on players
- Various balancing changes
- Dandelion now works in PvP against flowers
- Lightning bounces no longer cause enemies to become aggressive
- Lightning bounces now slightly stun mobs a bit
- Adjusted stats of various petals`, date: `May 12, 2025`},
       {text:`- Ascended reloading tanks now apply their effects
- Buffed various Ascended petals
- Summons no longer push around Ascended tanks
- Petal containers now only generate when needed
- Tweaked R button on mobile
- Adjusted slowdown for high-rarity petals
- Reworked Emerald effect on bosses
- Adjusted a few Ascended tanks to shoot in the direction of the player
- Various balancing changes`, date: `May 11, 2025`},
       {text:`- 2 new mobs have arrived in Desert
- 2 new petals have arrived in Desert
- New special waves have been added to Desert`, date: `May 9, 2025`},
     {text:`- Added 3 new extremely powerful rare petals
- Balanced slowdown stats for high rarities
- Buffed Rock petal damage
- Adjusted Spider boss to be more balanced across waves
- Significantly buffed some Astral petals
- Fixed bugs with announcements
- Fixed various other bugs`, date: `May 8, 2025`},
     {text:`- All Ant mobs are now smaller
- Updated Ant mob renders
- Adjusted some special waves and added a new one
- Missile & Fire Missile buffed
- Reduced the healing reduction from Dandelion mobs
- Buffed Peas and Grapes slightly 
- Buffed Oranges
- Buffed Wing
- Buffed Waterlogged Compass
- Added a new setting to turn off craft announcements
- Buffed Lightning damage
- Fixed various more bugs`, date: `May 7, 2025`},
     {text:`- Buffed Leaf damage
- Fixed various bugs`, date: `May 6, 2025`},
    
    {text:`- Adjusted mob health reductions based on player count in squads`, date: `May 5, 2025`},
    
    {text:`- Players now have a 5 second countdown before joining the game
- Summon HP now always uses 4-player health`, date: `May 3, 2025`},
    {text:`- Added another 6 new bosses to the game
- Added a /deaths command
- Fixed a bug with high rarity Shade having unintended high stats
- Adjusted mob health reduction based on player count
- Fixed cloning Leeches and Electric Eels
- Doubled the entity cap in the Arena before a boss is failed`, date: `May 1, 2025`},
    {text:`- Added 6 new bosses to the game
- Fixed a bug with Jellyfish Egg & Ruby
- Reworked starting wave calculation in squads; now capped at one wave below the lowest player's personal best instead of their startwave
- Reworked Stick; multiple sticks no longer stack between each other but each stick is much more powerful
- Fixed a bug where Shade could be less effective than intended
- Hopefully fixed a bug where Toxin could continue to spread after death`, date: `April 30, 2025`},
    {text:`- Missiles no longer count as mobs for the next wave to spawn
- Reworked Shade
- 6-player squads have arrived for Lv200+; currently in testing
- Adjusted stats of various petals
- Fixed some bugs`, date: `April 29, 2025`},
    {text:`- Dandelions now deal % healing reduction instead of an additive effect
- Buffed common DPS petals to be better than rare DPS petals of the previous rarity`, date: `April 28, 2025`},
    {text:`- A new petal has been added to Desertc
- Adjusted some rare drops to be more obtainable without dailies
- Slightly nerfed the Desert biome in difficulty
- Buffed every Astral petal
- Various petal balancing, including a massive buff to Coral`, date: `April 27, 2025`},
    {text:`- Fixed bugs with Petal Containers having the wrong number of mini-petals
- Squads now use "nameless" Petal Containers again
- Nerfed Dandelion projectiles' healing reduction by a little over half
- Fixed Rose Mob allowing bosses to heal infinitely
- Buffed various Astral petals
- Buffed summon petals in the Arena
- Increased shoot distance for Neutron Star`, date: `April 26, 2025`},
    {text: `- Dandelion mob projectiles' effect no longer reduces by % per frame; now each effect lasts exactly 10 seconds and stacks additively
- Dandelion mob projectiles' effect now applies to all types of healing including Roses, Dahlias & Radiance
- Increased power spent to spawn Astral+ mobs`, date: `April 25, 2025`},
    {text: `- Petal Containers / Enemy Boxes now use images. These changes aren't final; feel free to post suggestions for how these images should look!
- Dandelion now works against flowers and bosses
- Hopefully fixed a bug that caused Plastic Boss to crash the game when it despawned in arena
- Changed renders for Shade, Shiny Bubble, Radiance, and Sand
- Buffed Corn
- Changed Color of Omnipotent
- The edges of fancy Petal Containers / Enemy Boxes now inherit the silly gradient
- Cached Mob Renders should properly display now(?)
- Sandstorms are a little rounder and their pets are now yellow!
- Tanksmith Sticks can spawn sandstorms like egg
- Nerfed Tanksmith Stick reload to like 10.6s
- Some Astral petals were updated to be more unique`, date: `April 24, 2025`},
    {text: `- Jolt buffed
- Crab & Coral mob nerfed, Starfish & Jellyfish health increased extremely slightly to compensate
- Fixed bugs with ascended eggs
- Increased droprate for Dark Spine`, date: `April 22, 2025`},
    {text: `- 2 new mobs have arrived in the Ocean
- 2 new petals have arrived in the Ocean
- Lightning now has 13 bounces at Omnipotent rarity
- High rarity Dandelion adjusted to reduce server lag
- Omnipotent Light now has 7 mini-petals, due to repeated community backlash for combining them into one big particle
- Emerald and Ruby droprates swapped
- Mobs now get smaller again after Wave 220, though they remain the same size from Waves 200 to 220
- Buffed Trios from -20% to -21% mob health`, date: `April 21, 2025`},
    {text: `- Dust now gives 1/4 priority when recalaculating enemy targets
- Toxin nerfed
- Buffed droprates for Astral+ mobs
- Added two new bosses to Desert
- Sapphire drops from Sapphired bosses increased to 1/4`, date: `April 20, 2025`},
    {text: `- Adjusted wave spawning formulas, making high rarity (Astral+) mobs quadratically more common
- Nerfed Sapphire
- Decreased Hornet and Spider population in Garden
- Added a new boss in Desert
- Fixed a bug with Dust`, date: `April 19, 2025`},
    {text: `- You can now hover over enemy boxes in-game to show their stats
- Sapphired bosses now drop 1/10 the normal Sapphire yield
- Air no longer stacks`, date: `April 18, 2025`},
    {text: `- You can now control your petal rotate speed with [E] and [Q]
- Adjusted Trident
- Sapphired bosses now drop 1/3 the normal Sapphire yield`, date: `April 17, 2025`},
    {text: `- Buffed Clover's lucky wave chance buff, and adjusted the formula for lucky wave chance reduction when it rolls
- Buffed Dust's priority reduction and reload time
- Increased droprates for Dust and Cutter
- Buffed reload time for higher rarity Bloom
- Nerfed Toxin poison a bit
- Increased distance for Spider boss minions
- Adjusted some Desert special waves`, date: `April 16, 2025`},
    {text: `- 4 new mobs have arrived in the Desert
- 4 new petals have arrived in the Desert
- Nerfed the health of most ants in the game
- Adjusted formulas for calculating Daily petal
- Nerfed all boss HP
- Transcendent mobs now stop the wave for longer and have better loot
- Adjusted stats of some petals`, date: `April 15, 2025`},
    {text: `- 2 new petals have arrived
- Slightly nerfed Salt
- Nerfed the health of most Missile projectiles shot by mobs
- Added a new special wave to Desert
- Buffed Omnipotent+ Honey
- Nerfed most special waves`, date: `April 14, 2025`},
    {text: `- Doubled the chance for a Square spawn
- Added a new boss to Garden
- Adjusted Garden boss chances & Garden spawning chances
- Adjusted transcendent spawn chances
- Fixed Waterlogged Compass
- Rose reload buffed and heal nerfed`, date: `April 13, 2025`},
    {text: `- Adjusted the formula for Astral crafting
- Added a new extremely rare chance to get x20 Supremes from Celestial mobs`, date: `April 12, 2025`},
    {text: `- Two new bosses have arrived in Ocean`, date: `April 12, 2025`},
    {text: `- A new petal has been added, found in all biomes extremely rarely
- A new mob has been added in the Ocean biome
- Added 1 new boss to Ocean
- Reworked Waterlogged Compass
- All petal mass modifiers increased for Omnipotent+ petals
- Celestial+ mobs now drop multiple petals if the petal drop is under Omnipotent
- Coral base damage buffed +58%
- Jellyfish boss red-zone attack buffed by +100% damage
- Buffed all droprates for Compass petals
- Nerfed the Bee Hornet special wave`, date: `April 11, 2025`},
    {text: `- Transcendent mob stats slightly rebalanced
- Added two new bosses
- Decreased the Captcha chance`, date: `April 11, 2025`},
    {text: `- Celestial and Seraphic mob droprates buffed
- Celestial and Seraphic mobs now expend more energy from the wave, making the wave slower
- A new powerful rarity of mob can spawn beyond Wave 230`, date: `April 10, 2025`},                    
    {text: `- Ascended Streak XP award nerfed to 1/100ths of the original amount
- Fixed tank functionality of Mandible, Claw, Coral and Stinger
- Various ascended balance changes`, date: `April 7, 2025`},
    {text: `- Some tanks have been buffed or nerfed
- Lightning tank now has a functionality
- Yin Yang tank now has a functionality
- Fixed mobs not showing droprates on gallery
- Seraphic dropping Omnipotent rates improved significantly
- Jellyfish Egg now correctly zaps in defensive mode`, date: `April 2, 2025`},
    {text: `- Ascension has been added, including a completely new gamemode!`, date: `April 1, 2025`},
    {text: `- Increased entity limit
- Updated formula for Astral dailies, which should now be yielding better results
- Lightning damage buffed 10%
- Light damage buffed 15%
- Emerald now works on bosses above 90% hp
- A cloned boss now has 50% less drops`, date: `March 6, 2025`},
    {text: `- Buffed Corn
- Arena bosses can now be "Failed" if too many mobs spawn without being cleared
`, date: `February 10, 2025`},
{text: `- Added 2 new mobs to Desert
`, date: `February 3, 2025`},
    {text: `- Changed daily streak petal rarity calculation
- Added two new petals
- Added a use for Waterlogged Compass
- Buffed Corn 
- Buffed Leaf significantly
- Nerfed Starfish slightly
- Buffed Yucca
- Buffed Rose
- Buffed Dahlia under Omnipotent
- Slightly buffed Wing
- Buffed Omnipotent Orange
- Buffed Heavy damage
- Slightly nerfed Rice
- Added slowdown stats for Celestial mobs
- Heavily buffed the chances for a Centipede or Evil Centipede in the Garden biome
- Buffed the chances for a Soil mob by 17x, but nerfed its droprates significantly
- Buffed the chances for a Soil mob in a special wave by 100x
- Waterlogged Compass is now a rare daily
`, date: `December 20, 2024`},
    {text: `- As a temporary solution to us developers being busy, we've extended game progression by 1 rarity until we can create a proper endgame
`, date: `December 10, 2024`},
    {text: `- Reduced the reload time of Sapphire
`, date: `December 6, 2024`},
        {text: `- Announcement: We'd like you to try our new game: evadesx.io!
- Evades X is a skill-based multiplayer dodging game that involves playing and making maps with endlessly creative mechanics.
- It is under active development by the OG 2 developers who founded flowr!
`, date: `November 27, 2024`},
    {text: `- Over the past few weeks, numerous small balancing changes have been made to the Arena in small updates
- Added new petal
- Adjusted some renders to look better
- Air's health nerf is calculated differently now
`, date: `October 8, 2024`},
    {text: `- Added a new exclusive petal. This petal will have many future usages, albeit not implemented yet.
- Added a way to obtain the new exclusive petal.
- Players now spawn / respawn in suitable positions in the Arena
- Summons in the Arena now target flowers
- Summons in the Arena spawned from different flowers no longer instakill each other
- Summons in the Arena now deal significant damage to other flowers
- Summons in the Arena now have knockback to other flowers
- Salt has been nerfed in the Arena
- Heavy now works in the Arena
- Mandible has been heavily nerfed in the Arena
- Pollen has been slightly nerfed in the Arena
- Trident has been heavily nerfed in the Arena
- Rose, Dahlia, and Shell are no longer absorbed by enemy flowers in the Arena
- All summoner petals balanced for Arena usage
- Rematching in the Arena now has a 5 second cooldown in the main room
- Arena petal scaling now applies to 1v1s as well
- Knockback now works in the Arena
- Husk has been slightly nerfed in the Arena
- Bone has been slightly nerfed in the Arena
- Powder has been buffed in the Arena
- Stinger has been nerfed in the Arena
- Healing petals in the Arena are now more balanced relative to each other
- Nerfed the Cactus boss
- Fixed Agar.io Cell stats in the mob gallery
- Heavily optimized the inventory in the Arena biome
- Fixed bugs related to incorrect petal layouts displayed in the Arena biome`, date: `September 29, 2024`},
    {text: `- Buffed back Salt completely, but fixed a bug where Salt and Sponge would ignore the max reflection damage
- Slightly adjusted Pearl stats
- Bud no longer heals players at full health
- Sponge period now scales with rarity
- Increased quality of life with how petal stats are displayed
- Added fourth biome (still in testing, won't be very balanced)`, date: `September 19, 2024`},
    {text: `- Bosses of mobs that are rarer now drop less loot, and bosses of mobs that are common now drop more loot
- Salt buffed back significantly
- Fangs & Coral buffed
- Added a new boss in each biome and balanced boss spawning rates slightly`, date: `September 18, 2024`},
    {text: `- Bug fixes
- Many more Omnipotent petals are now special. This may inadverdently buff them even if they aren't listed as a buffed petal below.
- Buffed petals based on stats: Magnet (Omnipotent), Powder (Omnipotent)
- Nerfed petals based on stats: Salt (Omega+), Bud (Mythic+), Starfish (slightly), Pearl (not noticable)`, date: `September 15, 2024`},
    {text: `- Buffed the Jelly petal
- Slightly buffed Pollen's damage
- Bosses past Wave 200 now continue to give better loot but at a much slower pace
- Removed Omnipotent attempt announcements
- Changed the look, radius, or mini-petal layout of some Omnipotent petals`, date: `September 11, 2024`},
    {text: `- Omnipotent Shell has been buffed
- Nerfed some impossible and cancerous bosses
- Shell petal range buffed`, date: `August 31, 2024`},
    {text: `- Fangs damage buffed
- Stinger damage buffed
- Dahlia petal health buffed
- Yucca healing buffed a lot
- Starfish healing slightly reduced`, date: `July 5, 2024`},
    {text: `- Players above Level 150 can now overfill a private squad to 5 players. These squads have increased mob health such that they give less loot per player.
- Stinger damage buffed significantly, Stinger reload lengthened
- Fangs healing and damage buffed
- High rarity Powder speed increased
- Peas damage buffed
- Sand damage buffed
- Slowdown rebalanced
- Super+ Web is now 1 large web instead of 3 mini-webs
- Sponge petal health nerfed
- Mandible reworked`, date: `July 4, 2024`},
    {text: `- Rock and Salt buffed`, date: `July 2, 2024`},
    {text: `- Boss chances buffed
- Rebalanced some petal chances from streak rewards
- XP buffed for Supreme+ mobs
- Rock petal buffed, now has extremely slight knockback, faster reload and more health`, date: `July 1, 2024`},
    {text: `- Some bosses were nerfed`, date: `June 28, 2024`},
    {text: `- Petal knockback rebalanced`, date: `June 27, 2024`},
    {text: `- Very small droprates now have higher precision
- Added multi-charged Omnipotent mobs for the tryhards who never touched grass
- Dandelion spawn rate buffed
- Corn reload buffed 10 -> 9s
- Shell reload buffed 2.1 -> 1.7s
- Oranges damage buffed 14.3 -> 14.4
- Rock damage buffed 14 -> 19
- Supreme+ Magnet range buffed
- Divine+ Rubber knockback buffed
- Air now inflates you
- Supreme+ Bubble knockback nerfed
- Soil health-increase buffed 180 -> 200`, date: `June 26, 2024`},
    {text: `- Added charged Omnipotent mobs, known as Astral mobs
- Mobs no longer shrink after Wave 175
- Rebalanced Omnipotent petals
- High rarity Honey reworked`, date: `June 12, 2024`},
    {text: `- Non-full squads now have less mob health (-17%/-33%/-48% for trio/duo/solo respectively)`, date: `April 14, 2024`},
    {text: `- Pearl now does 4x less damage to bosses
- 2-player and 3-player squads now have less mob health (-15%/-30%/-45% -> -16%/-32%/-45%)
- Summoned pets are now slightly smaller and less massive
`, date: "April 11, 2024"},
    {text: `- Pearl armor buffed -34 -> -14
- Pearl health buffed 510 -> 910
- Fixed a bug where the whole Stinger cluster would die even if just one would have killed the enemy
- Corn, Bone, Pearl are the only petals that "stick" now
- Leaf damage buffed 20 -> 24
- Leaf health buffed 10 -> 12
- Fabled+ Leaf is a cluster of 3 now!
- Stinger health no longer splits with tringer/pinger
- Stinger damage 142 -> 145
- Stinger health 4 -> 5
- Rice damage buffed 12 -> 13.5
`, date: "April 10, 2024"},
    {text: `- Peas and Grapes have been reworked! They now have much more health when fired, and bounce off walls!
- Fixed a bug where low rarity compasses had super fast reload
- Missile health has been slightly nerfed, 28 -> 26
- Stinger damage buffed 112 -> 142
- Stinger reload nerfed 3.4 -> 4
- Sand damage buffed 8.95 -> 9
- Light damage buffed 25 -> 26
- Faster damage buffed 14 -> 14.5
- Faster rotation nerfed; rad/s now transitions smoothly from 2.7 at Ultra to 6.3 at Omnipotent.
- Rice damage buffed 15.5 -> 16
- Rice now has 0 reload.
- High-rarity rice has been made big!
- Petals like Corn now "stick" to mobs, similar to florr.
- Starfish healing buffed 11.8 -> 13.5 
- Starfish damage nerfed 38 -> 30 (Leaf should be the one with damage; Starfish should be for quick healing!)
- Starfish health buffed 10 -> 11
- Leaf damage buffed 18 -> 20
- Salt reflection scales much faster, matching the widening gap in enemy HP and damage.
- Fixed a bug where petals would not take damage if enemies were instakilled (this is TECHNICALLY not a pearl nerf, just a bugfix).

Overall, this update aims to shift the meta to some new and interesting stuff as it's been a while since we had some interesting builds.
`, date: "April 9, 2024"},
    {text: `- Compass is actually useful now!
- Stinger petal damage buffed`, date: "March 28, 2024"},
    {text: `- Game is finally named flowr.fun
- Fixed a few more disconnection bugs`, date: "March 23, 2024"},
    {text: `- Reconnecting has been made EVEN MORE effective
- Captcha chances have been reduced significantly
- Captcha no longer requires reload to solve
- Large server optimizations made
- Rice damage buffed 15 -> 15.5`, date: "March 22, 2024"},
    {text: `- A changelog has now been added. Only large or influential updates are shown below this point.
- Added 2 new petals
- Changed how the Stinger petal looks
- Bone petal health buffed
- Cactus petal damage buffed
- Cactus petal reload nerfed
- Cactus petal gives less maximum health than before`, date: "March 21, 2024"},
    
    {text: `- Petal Health is now visible on your loadout`, date: "March 16, 2024"},
    {text: `- Revamped Pearl`, date: "February 6, 2024"},
    {text: `- Added reconnection logic
- Added the ability to change passwords`, date: "January 10, 2024"},
    {text: `- Added bosses`, date: "January 4, 2024"},
    {text: `- Added Mob Gallery
- Less flowers in the room now reduces mob health`, date: "January 1, 2024"},
    {text: `- Petal Reload is now visible on your loadout`, date: "December 27, 2023"},
    {text: `- Added Ocean biome`, date: "December 21, 2023"},
    {text: `- Flowr officially released`, date: "September 24, 2023"},
    {text: `- Work on the project has begun`, date: "July 17, 2023"},

]


class Changelog {
    constructor(){
        this.entries = [];



        this.x = 110;
        this.y = 20;
        this.w = 500;
        this.h = 50 * 10 + 7;

        this.offset = -this.h - 40;
        this.targetOffset = -this.h - 40;
        this.active = false;


        this.scroll = 5;
        this.render = {scroll: this.scroll};

        this.menuHeights = {beginning: 0, end: this.h};
        this.scrollbar = {top: 0, bottom: 0, renderTop: 0, renderBottom: 0, length: 150};


        // this.scrollbar.bottom = (canvas.h - this.h - 20) + 60 - this.scrollbar.length * 7/8
        // this.scrollbar.top = this.scrollbar.bottom + this.scrollbar.length / 2
        const scrollBarProjections = {
            top: (20) + this.scrollbar.length*.5 + 60,
            bottom: (this.h + 20) - this.scrollbar.length*.5 + 30
        }
        this.scrollbar.top = this.scrollbar.bottom = scrollBarProjections.top + this.scrollbar.length;
        this.scrollbar.renderBottom = this.scrollbar.bottom;
        this.scrollbar.renderTop = this.scrollbar.top;

        this.draggingScrollBar = false;

        this.hoveringOverScrollbar = false;
        this.scrollBarActive = true;
        this.hoveringOverX = false;
    }
    toggle(){
        this.active = !this.active;
        if(this.active){
            this.generateEntries();
            // open
            this.targetOffset = 0;
        } else {
            // close
            this.targetOffset = -this.h - 40;
        }
    }
    resizeScroll(){
        if(this.resizeFlag !== undefined) {
            return;
        }
        const scrollBarProjections = {
            top: (20) + this.scrollbar.length*.5 + 60,
            bottom: (this.h + 20) - this.scrollbar.length*.5 + 30
        }
        this.scrollbar.top = this.scrollbar.bottom = scrollBarProjections.top + this.scrollbar.length;

        this.resizeFlag = true;
    }
    mouseDown({mouseX, mouseY}){
      
        if(
            mouseX < this.w - 16 + 12 + 110 &&
            mouseX > this.w - 16 - 12 + 110 &&
            mouseY > (this.scrollbar.bottom) &&
            mouseY < (this.scrollbar.top)
        ){
            this.draggingScrollBar = true;
        }
    }
    mouseUp({mouseX, mouseY}){
        this.draggingScrollBar = false;
        // delete this.scrollbarMouseOffset;
    }
    updateScroll(/*delta*/{x,y}, {mouseX, mouseY}){
        if(this.active !== true){
            return;
        }
        
        if(mouseX < 110 || mouseY < 20 || mouseX > 110 + this.w || mouseY > this.h + 20){
            return;
        }

        this.scroll -= y;
        if(this.scroll > 0) this.scroll = 0;
        else if(this.scroll < this.totalPetalHeight) this.scroll = this.totalPetalHeight;
    }
    mouseMove({mouseX, mouseY}){
        //console.log(mouseX, mouseY);
        if(
            mouseX < this.w - 16 + 12 + 110 &&
            mouseX > this.w - 16 - 12 + 110 &&
            mouseY > (this.scrollbar.bottom) &&
            mouseY < (this.scrollbar.top)
        ){
            this.hoveringOverScrollbar = true;
            //console.log("TRUE");
            // setCursor('pointer');
            // this.scrollbarMouseOffset = 0//(this.scrollbar.top) * ((this.h - 82 - 16) / this.h) + 82 + (canvas.h - this.h - 20) - mouseY;
        } else {
            this.hoveringOverScrollbar = false;
        }
        
        if(this.draggingScrollBar !== true){
            
            return;
        }
        
        const scrollBarProjections = {
            top: (20) + this.scrollbar.length*.5 + 60,
            bottom: (this.h + 20) - this.scrollbar.length*.5 + 30
        }

        const mouseProjections = {
            top: scrollBarProjections.top - this.scrollbar.length * .25,
            bottom: scrollBarProjections.bottom + this.scrollbar.length * .33
        }

        let ratio = (mouseY - mouseProjections.top) / (mouseProjections.bottom - mouseProjections.top);
        if(ratio < 0){
            ratio = 0;
        } else if(ratio > 1){
            ratio = 1;
        }
        //console.log(ratio);

        // console.log(mouseY - scrollBarProjections.top);

        
        this.scroll = ratio * (this.totalPetalHeight) //* ((this.h - 82 - 16 * 2) / this.h);
       
    }
    draw(){
        //if(!this.active){return};
        ctx.textBaseline = 'middle';
        ctx.fontKerning = "none";
        ctx.letterSpacing = "-.1px";
        this.offset = interpolate(this.offset, this.targetOffset, 0.3);
        

        this.currentHeight = 5;

        ctx.translate(this.x, this.y + this.offset);
        ctx.fillStyle = '#9bb56b';
        ctx.strokeStyle = '#7f9458';
        ctx.lineWidth = 8;

        ctx.beginPath();
        ctx.roundRect(0, 0, this.w, this.h, 3);
        ctx.fill();
        ctx.stroke();
        ctx.closePath();

        this.render.scroll = interpolate(this.render.scroll, this.scroll, 0.0070 * dt);

        ctx.save();
        ctx.beginPath();
        ctx.roundRect(0, 80, this.w, this.h - 80, 3);
        ctx.clip();
        let entrypadding = 10;

        let yoff = 100 + entrypadding;
        for(let i = 0; i < this.entries.length; i++){
            yoff +=this.entries[i].h/2
            this.renderEntry(this.entries[i], yoff);
            yoff += this.entries[i].h/2 + entrypadding;
        }
        ctx.restore();

        ctx.beginPath();
        ctx.roundRect(0, 0, this.w, this.h, 3);
        ctx.stroke();
        ctx.closePath();

        ctx.font = `900 30px 'Ubuntu'`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        ctx.fillStyle = 'white';
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 4;
        ctx.strokeText("Changelog", this.w/2, 40);
        ctx.fillText("Changelog", this.w/2, 40);

        

        this.menuHeights = {
            beginning: 100 + entrypadding, //- petalContainerSize * 1/2,
            end:   yoff - this.h + 70 + 80//+ petalContainerSize * 4
        }

       
            
        let padding = 100;
     
        const scrollBarProjections = {
            top: (20) + this.scrollbar.length*.5 + 60,
            bottom: (this.h + 20) - this.scrollbar.length*.5 + 30
        }
        

        this.totalPetalHeight = (this.menuHeights.beginning - this.menuHeights.end);

       
        if(this.scroll > 0) this.scroll = 0;
        else if(this.scroll < this.totalPetalHeight) this.scroll = this.totalPetalHeight;

        const ratio = this.scroll / this.totalPetalHeight;
         //console.log(ratio);

        this.scrollbar.bottom = interpolate(scrollBarProjections.top, scrollBarProjections.bottom, ratio) - this.scrollbar.length / 2//this.scroll / (this.totalPetalHeight) * (scrollBarProjections.bottom - scrollBarProjections.top) + scrollBarProjections.top + this.scrollbar.length / 2 - (canvas.h - this.h - 20);
        // this.scrollbar.bottom = this.scroll / (this.totalPetalHeight + this.scrollbar.length) * (scrollBarProjections.bottom - scrollBarProjections.top) + scrollBarProjections.top - this.scrollbar.length/2;
        this.scrollbar.top = this.scrollbar.bottom + this.scrollbar.length / 2//this.scrollbar.bottom - this.scrollbar.length / 2;
    
        this.scrollbar.renderTop = interpolate(this.scrollbar.renderTop, this.scrollbar.top, this.draggingScrollBar ? 0.28 : 0.08);
        this.scrollbar.renderBottom = interpolate(this.scrollbar.renderBottom, this.scrollbar.bottom, this.draggingScrollBar ? 0.28 : 0.08);

        // console.log(this.scrollBarActive);
        if(this.scrollBarActive !== false){
            ctx.translate(0, -(20));
            ctx.strokeStyle = '#7f9458';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(this.w - 16, (this.scrollbar.renderTop) /** ((this.h - 82 - 16) / this.h) + 82*/);
            ctx.lineTo(this.w - 16, (this.scrollbar.renderBottom) /** ((this.h - 82 - 16) / this.h) + 82*/);
            ctx.stroke();
            ctx.closePath();
            ctx.translate(0, (20));
        }

        if(this.active === true){
            if(mouse.canvasX > this.x + this.w - 7.5 - 30 - 3 && mouse.canvasY > this.y + 7.5 + 3 && mouse.canvasX < this.x + this.w - 7.5 - 3 && mouse.canvasY < this.y + 7.5 + 30 + 3){
                ctx.fillStyle = "#c16666";
                setCursor('pointer');
                this.hoveringOverX = true;
            } else {
                // if(this.hoveringOverButton === false){
                //     document.body.style.cursor = 'auto';
                // }
                this.hoveringOverX = false;
                ctx.fillStyle = '#c1565e';
            }
        } else {
            ctx.fillStyle = '#c1565e';
            this.hoveringOverX = false;
        }

        ctx.translate(-3, 3);
        ctx.strokeStyle = '#90464b';
        ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.roundRect(this.w - 7.5 - 30, 7.5, 30, 30, 6);
        ctx.fill();
        ctx.stroke();
        ctx.closePath();

        ctx.lineWidth = 4.75;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#cccccc';
        ctx.beginPath();
        ctx.moveTo(this.w - 30, 30);
        ctx.lineTo(this.w - 7.5 * 2, 7.5 + 7.5);
        ctx.stroke();
        ctx.closePath();
        ctx.beginPath();
        ctx.moveTo(this.w - 7.5 * 2, 30);
        ctx.lineTo(this.w - 30, 7.5 + 7.5);
        ctx.stroke();
        ctx.closePath();
        ctx.translate(3, -3);

        ctx.translate(-this.x, -this.y - this.offset);
    }

    renderEntry(entry, yoffset){

        if(this.render.scroll + yoffset < 0 || this.render.scroll + yoffset > this.h + 100) return;

        ctx.font = `900 ${entry.fontSize ?? 19}px 'Ubuntu'`;
        ctx.textAlign = "left";
        ctx.textBaseline = "middle";

        ctx.fillStyle = 'white';
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;

        if(entry.type == 'divider'){
            ctx.strokeStyle = '#7f9458';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(20, yoffset + this.render.scroll);
            ctx.lineTo(this.w - 20 - 16, yoffset + this.render.scroll);
            ctx.stroke();
            ctx.closePath();

        }else if(entry.type == 'date'){
            ctx.lineWidth = 3;
            ctx.strokeText(entry.text, 20, yoffset + this.render.scroll);
            ctx.fillText(entry.text, 20, yoffset + this.render.scroll);
        }else {
            ctx.strokeText(entry.text, 28, yoffset + this.render.scroll);
            ctx.fillText(entry.text, 28, yoffset + this.render.scroll);
        }

        
    }

    getLines(ctx, text, maxWidth) {
        //maxWidth *= window.innerWidth/canvas.w;
        
        var words = text.split(" ");
        var lines = [];
        var currentLine = words[0];
    
        for (var i = 1; i < words.length; i++) {
            var word = words[i];
            var width = ctx.measureText(currentLine + " " + word).width;
            if (width < maxWidth) {
                currentLine += " " + word;
            } else {
                lines.push(currentLine);
                currentLine = word;
            }
        }
        lines.push(currentLine);
        return lines;
    }


    generateEntries(){
        let ret = []
        for(let entry of changeloglist){
            ret.push({
                type: "date",
                text: entry.date,
                fontSize: 22,
                h: 34
            })
            let paragraphs = entry.text.split("\n");
            for(let paragraph of paragraphs){
                ctx.font = `900 16px 'Ubuntu'`;
                let lines = this.getLines(ctx, paragraph, this.w - 54);
                for(let line of lines){
                    ret.push({
                        type: "text",
                        text: line,
                        fontSize: 16,
                        h: 15
                    })
                }
            }
            ret.push({
                type: "divider",
                h: 20
            })
            
            
        }
        this.entries = ret;
    }
    
    
}

const changelog = new Changelog();
